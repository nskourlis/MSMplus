<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>MSMplus</title>


<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">MSMplus</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw">library</span>(<span class="st">&quot;MSMplus&quot;</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw">library</span>(<span class="st">&quot;survival&quot;</span>)</a>
<a class="sourceLine" id="cb1-3" title="3"><span class="kw">library</span>(<span class="st">&quot;mstate&quot;</span>)</a>
<a class="sourceLine" id="cb1-4" title="4"><span class="kw">library</span>(<span class="st">&quot;dplyr&quot;</span>)</a>
<a class="sourceLine" id="cb1-5" title="5"><span class="kw">library</span>(<span class="st">&quot;reshape2&quot;</span>)</a>
<a class="sourceLine" id="cb1-6" title="6"><span class="kw">library</span>(<span class="st">&quot;flexsurv&quot;</span>)</a>
<a class="sourceLine" id="cb1-7" title="7"><span class="kw">library</span>(<span class="st">&quot;msm&quot;</span>)</a>
<a class="sourceLine" id="cb1-8" title="8"><span class="kw">library</span>(<span class="st">&quot;RJSONIO&quot;</span>)</a></code></pre></div>
<p>MSMplus is a useful tool for presentation of results from a multi-state analysis in an easy, comprehensible and meaningful way. It aids the user to present research findings to targeted audiences.</p>
<p>However, the results need to be provided to the app either as a csv/excel or a json file of specific structure.</p>
<p>The advisable approach is the manual creation of an excel/csv file with the analysis results by the researcher according to certain formatting and naming rules described in this <a href="https://nskbiostatistics.shinyapps.io/supplementary/">tutorial</a>.</p>
<p>Here is an example data file structure:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb2-1" title="1"><span class="kw">load</span>(<span class="st">&quot;excel_input_file_ex.rda&quot;</span>, <span class="dt">envir =</span> <span class="kw">parent.frame</span>(), <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb2-2" title="2"></a>
<a class="sourceLine" id="cb2-3" title="3">excel_input_file_ex[<span class="dv">104</span><span class="op">:</span><span class="dv">106</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">39</span>]</a>
<a class="sourceLine" id="cb2-4" title="4"><span class="co">#&gt;     timevar Nats Ntransitions      atlist Haz_1_to_2 Haz_1_to_3 Haz_diff_1_to_2</span></a>
<a class="sourceLine" id="cb2-5" title="5"><span class="co">#&gt; 104     0.6    3            3 ag2 1 ag3 0    1.20723    0.51513         0.20698</span></a>
<a class="sourceLine" id="cb2-6" title="6"><span class="co">#&gt; 105     0.9    3            3 ag2 1 ag3 0    0.51067    0.47362         0.08756</span></a>
<a class="sourceLine" id="cb2-7" title="7"><span class="co">#&gt; 106     1.2    3            3 ag2 1 ag3 0    0.23974    0.36318         0.04110</span></a>
<a class="sourceLine" id="cb2-8" title="8"><span class="co">#&gt;     Haz_diff_1_to_3 Haz_ratio_1_to_2 Haz_ratio_1_to_3 P_1_to_1 P_1_to_2</span></a>
<a class="sourceLine" id="cb2-9" title="9"><span class="co">#&gt; 104        -0.13162          1.20693           0.7965  0.42514  0.52207</span></a>
<a class="sourceLine" id="cb2-10" title="10"><span class="co">#&gt; 105        -0.12101          1.20693           0.7965  0.37407  0.53851</span></a>
<a class="sourceLine" id="cb2-11" title="11"><span class="co">#&gt; 106        -0.09279          1.20693           0.7965  0.34682  0.53506</span></a>
<a class="sourceLine" id="cb2-12" title="12"><span class="co">#&gt;     P_1_to_3 P_diff_1_to_1 P_diff_1_to_2 P_diff_1_to_3 P_ratio_1_to_1</span></a>
<a class="sourceLine" id="cb2-13" title="13"><span class="co">#&gt; 104  0.05279      -0.05131       0.06698      -0.01567        0.89231</span></a>
<a class="sourceLine" id="cb2-14" title="14"><span class="co">#&gt; 105  0.08742      -0.04309       0.06710      -0.02401        0.89671</span></a>
<a class="sourceLine" id="cb2-15" title="15"><span class="co">#&gt; 106  0.11812      -0.03864       0.06815      -0.02951        0.89976</span></a>
<a class="sourceLine" id="cb2-16" title="16"><span class="co">#&gt;     P_ratio_1_to_2 P_ratio_1_to_3 Visit_1_to_1 Visit_1_to_2 Visit_1_to_3</span></a>
<a class="sourceLine" id="cb2-17" title="17"><span class="co">#&gt; 104        1.14718        0.77111            1      0.53154      0.05279</span></a>
<a class="sourceLine" id="cb2-18" title="18"><span class="co">#&gt; 105        1.14234        0.78453            1      0.56266      0.08742</span></a>
<a class="sourceLine" id="cb2-19" title="19"><span class="co">#&gt; 106        1.14596        0.80011            1      0.57514      0.11812</span></a>
<a class="sourceLine" id="cb2-20" title="20"><span class="co">#&gt;     Visit_diff_1_to_1 Visit_diff_1_to_2 Visit_diff_1_to_3 Visit_ratio_1_to_1</span></a>
<a class="sourceLine" id="cb2-21" title="21"><span class="co">#&gt; 104                 0           0.06707          -0.01567                  1</span></a>
<a class="sourceLine" id="cb2-22" title="22"><span class="co">#&gt; 105                 0           0.06692          -0.02401                  1</span></a>
<a class="sourceLine" id="cb2-23" title="23"><span class="co">#&gt; 106                 0           0.06806          -0.02951                  1</span></a>
<a class="sourceLine" id="cb2-24" title="24"><span class="co">#&gt;     Visit_ratio_1_to_2 Visit_ratio_1_to_3 Los_1_to_1 Los_1_to_2 Los_1_to_3</span></a>
<a class="sourceLine" id="cb2-25" title="25"><span class="co">#&gt; 104            1.14440            0.77111    0.13163    0.06373    0.00464</span></a>
<a class="sourceLine" id="cb2-26" title="26"><span class="co">#&gt; 105            1.13499            0.78453    0.17123    0.11710    0.01167</span></a>
<a class="sourceLine" id="cb2-27" title="27"><span class="co">#&gt; 106            1.13422            0.80011    0.20715    0.17085    0.02201</span></a>
<a class="sourceLine" id="cb2-28" title="28"><span class="co">#&gt;     Los_diff_1_to_1 Los_diff_1_to_2 Los_diff_1_to_3 Los_ratio_1_to_1</span></a>
<a class="sourceLine" id="cb2-29" title="29"><span class="co">#&gt; 104        -0.00724         0.00863        -0.00139          0.94785</span></a>
<a class="sourceLine" id="cb2-30" title="30"><span class="co">#&gt; 105        -0.01195         0.01536        -0.00341          0.93479</span></a>
<a class="sourceLine" id="cb2-31" title="31"><span class="co">#&gt; 106        -0.01601         0.02211        -0.00610          0.92827</span></a>
<a class="sourceLine" id="cb2-32" title="32"><span class="co">#&gt;     Los_ratio_1_to_2 Los_ratio_1_to_3  User_1 User_diff_1</span></a>
<a class="sourceLine" id="cb2-33" title="33"><span class="co">#&gt; 104          1.15665          0.76972 0.19536     0.00139</span></a>
<a class="sourceLine" id="cb2-34" title="34"><span class="co">#&gt; 105          1.15094          0.77382 0.28833     0.00341</span></a>
<a class="sourceLine" id="cb2-35" title="35"><span class="co">#&gt; 106          1.14862          0.78298 0.37799     0.00610</span></a></code></pre></div>
<p>We have created an alternative way for deriving the MSMplus input files to avoid the labour. The json files can be easily derived while running the multi-state models. In Stata, this is done via the commands msboxes and predictms and in R via the current package and the use of its funtions: flexjson, msmjson, mstatejson. That being said we still advise for the manual approach as the researcher does not need to have any knowledge of R or Stata, as the analysis can be conducted via any statistical software.</p>
<p>The user can locally launch the MSMplus application by writting MSMplus_prepare::runMSMplus() or access it online at <a href="https://nskbiostatistics.shinyapps.io/MSMplus/" class="uri">https://nskbiostatistics.shinyapps.io/MSMplus/</a></p>
<div id="files-input-preparation" class="section level1">
<h1>Files input preparation</h1>
<div id="function-msboxes_r" class="section level2">
<h2>Function msboxes_R</h2>
<div id="generating-information-to-create-a-multi-state-graph-with-updated-frequencies-in-each-state-across-different-time-points" class="section level3">
<h3>Generating information to create a multi-state graph with updated frequencies in each state across different time points</h3>
<p>We will start by using data from the European Blood and Marrow Transplant registry. The dataset consists of 2204 patients who received bone marrow transplantation. The three states a patient can be in is 1) Post- transplant, 2) Platelet recovery 3) Relapse/Death. The covariate patterns used in this example are the 3 age categories, namely &lt;20 y.old, 20-40y.old and &gt;40 y.old . This dataset is freely available from mstate package and you can access more information by typing ?ebmt3.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1"><span class="kw">load</span>(<span class="st">&quot;ebmt.rda&quot;</span>, <span class="dt">envir =</span> <span class="kw">parent.frame</span>(), <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb3-2" title="2"></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw">head</span>(ebmt)</a>
<a class="sourceLine" id="cb3-4" title="4"><span class="co">#&gt;   X id prtime prstat rfstime rfsstat dissub   age            drmatch    tcd</span></a>
<a class="sourceLine" id="cb3-5" title="5"><span class="co">#&gt; 1 1  1     23      1     744       0    CML   &gt;40    Gender mismatch No TCD</span></a>
<a class="sourceLine" id="cb3-6" title="6"><span class="co">#&gt; 2 2  2     35      1     360       1    CML   &gt;40 No gender mismatch No TCD</span></a>
<a class="sourceLine" id="cb3-7" title="7"><span class="co">#&gt; 3 3  3     26      1     135       1    CML   &gt;40 No gender mismatch No TCD</span></a>
<a class="sourceLine" id="cb3-8" title="8"><span class="co">#&gt; 4 4  4     22      1     995       0    AML 20-40 No gender mismatch No TCD</span></a>
<a class="sourceLine" id="cb3-9" title="9"><span class="co">#&gt; 5 5  5     29      1     422       1    AML 20-40 No gender mismatch No TCD</span></a>
<a class="sourceLine" id="cb3-10" title="10"><span class="co">#&gt; 6 6  6     38      1     119       1    ALL   &gt;40 No gender mismatch No TCD</span></a></code></pre></div>
<p>Let’s first define the transition matrix</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">tmat &lt;-<span class="st"> </span><span class="kw">transMat</span>(<span class="dt">x =</span> <span class="kw">list</span>(<span class="kw">c</span>(<span class="dv">2</span>, <span class="dv">3</span>),<span class="kw">c</span>(<span class="dv">3</span>), <span class="kw">c</span>() ), <span class="dt">names =</span> <span class="kw">c</span>(<span class="st">&quot;Transplant&quot;</span>, <span class="st">&quot;Platelet Recovery&quot;</span>, <span class="st">&quot;Relapse/Death&quot;</span> ) )</a></code></pre></div>
<p>We will now create dummy variables for the age categories</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb5-1" title="1">ebmt<span class="op">$</span>age2=<span class="st">  </span><span class="kw">recode</span>(ebmt<span class="op">$</span>age, <span class="st">&quot;&gt;40&quot;</span> =<span class="dv">0</span>, <span class="st">&quot;20-40&quot;</span>=<span class="dv">1</span>,<span class="st">&quot;&lt;=20&quot;</span> =<span class="dv">0</span> )</a>
<a class="sourceLine" id="cb5-2" title="2">ebmt<span class="op">$</span>age3=<span class="st">  </span><span class="kw">recode</span>(ebmt<span class="op">$</span>age, <span class="st">&quot;&gt;40&quot;</span> =<span class="dv">1</span>, <span class="st">&quot;20-40&quot;</span>=<span class="dv">0</span>,<span class="st">&quot;&lt;=20&quot;</span> =<span class="dv">0</span> )</a></code></pre></div>
<p>Data preparation- From one row per participant to multiple rows per participant, one for each allowed transition.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1">msebmt &lt;-<span class="st"> </span><span class="kw">msprep</span>(<span class="dt">data =</span> ebmt, <span class="dt">trans =</span> tmat, </a>
<a class="sourceLine" id="cb6-2" title="2">                 <span class="dt">time =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="st">&quot;prtime&quot;</span>, <span class="st">&quot;rfstime&quot;</span>), <span class="dt">status =</span> <span class="kw">c</span>(<span class="ot">NA</span>, <span class="st">&quot;prstat&quot;</span>, <span class="st">&quot;rfsstat&quot;</span>), <span class="dt">keep=</span><span class="kw">c</span>(<span class="st">&quot;age2&quot;</span>,<span class="st">&quot;age3&quot;</span>))</a>
<a class="sourceLine" id="cb6-3" title="3"></a>
<a class="sourceLine" id="cb6-4" title="4"><span class="kw">head</span>(msebmt)</a>
<a class="sourceLine" id="cb6-5" title="5"><span class="co">#&gt; An object of class &#39;msdata&#39;</span></a>
<a class="sourceLine" id="cb6-6" title="6"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb6-7" title="7"><span class="co">#&gt; Data:</span></a>
<a class="sourceLine" id="cb6-8" title="8"><span class="co">#&gt;   id from to trans Tstart Tstop time status age2 age3</span></a>
<a class="sourceLine" id="cb6-9" title="9"><span class="co">#&gt; 1  1    1  2     1      0    23   23      1    0    1</span></a>
<a class="sourceLine" id="cb6-10" title="10"><span class="co">#&gt; 2  1    1  3     2      0    23   23      0    0    1</span></a>
<a class="sourceLine" id="cb6-11" title="11"><span class="co">#&gt; 3  1    2  3     3     23   744  721      0    0    1</span></a>
<a class="sourceLine" id="cb6-12" title="12"><span class="co">#&gt; 4  2    1  2     1      0    35   35      1    0    1</span></a>
<a class="sourceLine" id="cb6-13" title="13"><span class="co">#&gt; 5  2    1  3     2      0    35   35      0    0    1</span></a>
<a class="sourceLine" id="cb6-14" title="14"><span class="co">#&gt; 6  2    2  3     3     35   360  325      1    0    1</span></a></code></pre></div>
<p>We can now call function msboxes_R</p>
<p>msboxes_R will create a json file containing parameters that will help MSMplus to automatically create the multi-state graph of each specific setting. However, the user has the option to design and create the multistate graph within the app as well.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"></a>
<a class="sourceLine" id="cb7-2" title="2">results3_days=MSMplus<span class="op">::</span><span class="kw">msboxes_R</span>(<span class="dt">data=</span>msebmt,<span class="dt">id=</span> msebmt<span class="op">$</span>id, <span class="dt">yb=</span><span class="kw">c</span>(<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.75</span>),</a>
<a class="sourceLine" id="cb7-3" title="3">                        <span class="dt">xb=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">0.2</span>,<span class="fl">0.7</span>),<span class="dt">boxwidth=</span><span class="fl">0.1</span>,<span class="dt">boxheight=</span><span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb7-4" title="4">                        <span class="dt">tmatrix=</span> tmat, <span class="dt">tstop=</span>msebmt<span class="op">$</span>Tstop,<span class="dt">vartime=</span><span class="kw">c</span>(<span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dt">by=</span><span class="dv">1</span>)),<span class="dt">scale=</span><span class="fl">365.25</span>,</a>
<a class="sourceLine" id="cb7-5" title="5">                        <span class="dt">jsonpath=</span><span class="st">&quot;~&quot;</span>, <span class="dt">name=</span><span class="st">&quot;msboxes_EBMT.json&quot;</span> ) </a>
<a class="sourceLine" id="cb7-6" title="6">results3_days</a>
<a class="sourceLine" id="cb7-7" title="7"><span class="co">#&gt; $Nstates</span></a>
<a class="sourceLine" id="cb7-8" title="8"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb7-9" title="9"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-10" title="10"><span class="co">#&gt; $Ntransitions</span></a>
<a class="sourceLine" id="cb7-11" title="11"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb7-12" title="12"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-13" title="13"><span class="co">#&gt; $xvalues</span></a>
<a class="sourceLine" id="cb7-14" title="14"><span class="co">#&gt; [1] 0.5 0.2 0.7</span></a>
<a class="sourceLine" id="cb7-15" title="15"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-16" title="16"><span class="co">#&gt; $yvalues</span></a>
<a class="sourceLine" id="cb7-17" title="17"><span class="co">#&gt; [1] 0.30 0.50 0.75</span></a>
<a class="sourceLine" id="cb7-18" title="18"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-19" title="19"><span class="co">#&gt; $boxwidth</span></a>
<a class="sourceLine" id="cb7-20" title="20"><span class="co">#&gt; [1] 0.1</span></a>
<a class="sourceLine" id="cb7-21" title="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-22" title="22"><span class="co">#&gt; $boxheight</span></a>
<a class="sourceLine" id="cb7-23" title="23"><span class="co">#&gt; [1] 0.1</span></a>
<a class="sourceLine" id="cb7-24" title="24"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-25" title="25"><span class="co">#&gt; $statenames</span></a>
<a class="sourceLine" id="cb7-26" title="26"><span class="co">#&gt; [1] &quot;State1&quot; &quot;State2&quot; &quot;State3&quot;</span></a>
<a class="sourceLine" id="cb7-27" title="27"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-28" title="28"><span class="co">#&gt; $transnames</span></a>
<a class="sourceLine" id="cb7-29" title="29"><span class="co">#&gt; [1] &quot;h1&quot; &quot;h2&quot; &quot;h3&quot;</span></a>
<a class="sourceLine" id="cb7-30" title="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-31" title="31"><span class="co">#&gt; $arrows</span></a>
<a class="sourceLine" id="cb7-32" title="32"><span class="co">#&gt; $arrows$x1</span></a>
<a class="sourceLine" id="cb7-33" title="33"><span class="co">#&gt; [1] 0.5 0.5 0.2</span></a>
<a class="sourceLine" id="cb7-34" title="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-35" title="35"><span class="co">#&gt; $arrows$y1</span></a>
<a class="sourceLine" id="cb7-36" title="36"><span class="co">#&gt; [1] 0.35 0.35 0.55</span></a>
<a class="sourceLine" id="cb7-37" title="37"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-38" title="38"><span class="co">#&gt; $arrows$x2</span></a>
<a class="sourceLine" id="cb7-39" title="39"><span class="co">#&gt; [1] 0.2 0.7 0.7</span></a>
<a class="sourceLine" id="cb7-40" title="40"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-41" title="41"><span class="co">#&gt; $arrows$y2</span></a>
<a class="sourceLine" id="cb7-42" title="42"><span class="co">#&gt; [1] 0.45 0.70 0.70</span></a>
<a class="sourceLine" id="cb7-43" title="43"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-44" title="44"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-45" title="45"><span class="co">#&gt; $arrowstext</span></a>
<a class="sourceLine" id="cb7-46" title="46"><span class="co">#&gt; $arrowstext$x</span></a>
<a class="sourceLine" id="cb7-47" title="47"><span class="co">#&gt; [1] 0.33 0.62 0.47</span></a>
<a class="sourceLine" id="cb7-48" title="48"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-49" title="49"><span class="co">#&gt; $arrowstext$y</span></a>
<a class="sourceLine" id="cb7-50" title="50"><span class="co">#&gt; [1] 0.400 0.525 0.625</span></a>
<a class="sourceLine" id="cb7-51" title="51"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-52" title="52"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-53" title="53"><span class="co">#&gt; $tmat</span></a>
<a class="sourceLine" id="cb7-54" title="54"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb7-55" title="55"><span class="co">#&gt; [1,]   NA    1    2</span></a>
<a class="sourceLine" id="cb7-56" title="56"><span class="co">#&gt; [2,]   NA   NA    3</span></a>
<a class="sourceLine" id="cb7-57" title="57"><span class="co">#&gt; [3,]   NA   NA   NA</span></a>
<a class="sourceLine" id="cb7-58" title="58"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-59" title="59"><span class="co">#&gt; $msm</span></a>
<a class="sourceLine" id="cb7-60" title="60"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb7-61" title="61"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb7-62" title="62"><span class="co">#&gt; $frequencies</span></a>
<a class="sourceLine" id="cb7-63" title="63"><span class="co">#&gt;       time_label State1 State2 State3   h1  h2  h3 timevar</span></a>
<a class="sourceLine" id="cb7-64" title="64"><span class="co">#&gt;  [1,]          1   2204      0      0    0   0   0       0</span></a>
<a class="sourceLine" id="cb7-65" title="65"><span class="co">#&gt;  [2,]          2    680    920    604 1168 356 248       1</span></a>
<a class="sourceLine" id="cb7-66" title="66"><span class="co">#&gt;  [3,]          3    629    852    723 1169 406 317       2</span></a>
<a class="sourceLine" id="cb7-67" title="67"><span class="co">#&gt;  [4,]          4    607    823    774 1169 428 346       3</span></a>
<a class="sourceLine" id="cb7-68" title="68"><span class="co">#&gt;  [5,]          5    594    805    805 1169 441 364       4</span></a>
<a class="sourceLine" id="cb7-69" title="69"><span class="co">#&gt;  [6,]          6    584    796    824 1169 451 373       5</span></a>
<a class="sourceLine" id="cb7-70" title="70"><span class="co">#&gt;  [7,]          7    580    789    835 1169 455 380       6</span></a>
<a class="sourceLine" id="cb7-71" title="71"><span class="co">#&gt;  [8,]          8    577    787    840 1169 458 382       7</span></a>
<a class="sourceLine" id="cb7-72" title="72"><span class="co">#&gt;  [9,]          9    577    786    841 1169 458 383       8</span></a>
<a class="sourceLine" id="cb7-73" title="73"><span class="co">#&gt; [10,]         10    577    786    841 1169 458 383       9</span></a>
<a class="sourceLine" id="cb7-74" title="74"><span class="co">#&gt; [11,]         11    577    786    841 1169 458 383      10</span></a></code></pre></div>
</div>
</div>
<div id="msmplus-json-input-file-of-predictions-the-flexjson-function" class="section level2">
<h2>MSMplus Json input file of predictions: The flexjson function</h2>
<p>Provide time vector</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb8-1" title="1">tgrid &lt;-<span class="st"> </span><span class="kw">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dt">by =</span> <span class="dv">1</span>)   </a></code></pre></div>
<p>Provide transition matrix</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1">tmat &lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="ot">NA</span>, <span class="dv">1</span>, <span class="dv">2</span>), <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="dv">3</span>), <span class="kw">c</span>(<span class="ot">NA</span>, <span class="ot">NA</span>, <span class="ot">NA</span>)) </a></code></pre></div>
<p>Run transition specific hazard models: Clock forward approach and use of flexible parametric models</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb10-1" title="1"></a>
<a class="sourceLine" id="cb10-2" title="2">cfwei.list&lt;-<span class="kw">vector</span>(<span class="dv">3</span>,<span class="dt">mode=</span><span class="st">&quot;list&quot;</span>)</a>
<a class="sourceLine" id="cb10-3" title="3"></a>
<a class="sourceLine" id="cb10-4" title="4"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>) {</a>
<a class="sourceLine" id="cb10-5" title="5">  </a>
<a class="sourceLine" id="cb10-6" title="6">  cfwei.list[[i]]&lt;-<span class="kw">flexsurvreg</span>(<span class="kw">Surv</span>(Tstart,Tstop,status)<span class="op">~</span>age2<span class="op">+</span>age3,<span class="dt">subset=</span>(trans<span class="op">==</span>i),</a>
<a class="sourceLine" id="cb10-7" title="7">                               <span class="dt">dist=</span><span class="st">&quot;weibull&quot;</span>,<span class="dt">data=</span>msebmt)</a>
<a class="sourceLine" id="cb10-8" title="8">}</a>
<a class="sourceLine" id="cb10-9" title="9"></a>
<a class="sourceLine" id="cb10-10" title="10">  </a></code></pre></div>
<p>Prediction for different covariate patterns (the 3 age categories)</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1">wh1 &lt;-<span class="st"> </span><span class="kw">which</span>(msebmt<span class="op">$</span>age2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>msebmt<span class="op">$</span>age3 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb11-2" title="2">pat1 &lt;-<span class="st"> </span>msebmt[<span class="kw">rep</span>(wh1[<span class="dv">1</span>], <span class="dv">3</span>), <span class="dv">9</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb11-3" title="3"><span class="kw">attr</span>(pat1, <span class="st">&quot;trans&quot;</span>) &lt;-<span class="st"> </span>tmat</a>
<a class="sourceLine" id="cb11-4" title="4"></a>
<a class="sourceLine" id="cb11-5" title="5"></a>
<a class="sourceLine" id="cb11-6" title="6">wh2 &lt;-<span class="st"> </span><span class="kw">which</span>(msebmt<span class="op">$</span>age2 <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>msebmt<span class="op">$</span>age3 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb11-7" title="7">pat2 &lt;-<span class="st"> </span>msebmt[<span class="kw">rep</span>(wh2[<span class="dv">1</span>], <span class="dv">3</span>), <span class="dv">9</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb11-8" title="8"><span class="kw">attr</span>(pat2, <span class="st">&quot;trans&quot;</span>) &lt;-<span class="st"> </span>tmat</a>
<a class="sourceLine" id="cb11-9" title="9"></a>
<a class="sourceLine" id="cb11-10" title="10">wh3 &lt;-<span class="st"> </span><span class="kw">which</span>(msebmt<span class="op">$</span>age2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>msebmt<span class="op">$</span>age3 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb11-11" title="11">pat3 &lt;-<span class="st"> </span>msebmt[<span class="kw">rep</span>(wh3[<span class="dv">1</span>], <span class="dv">3</span>), <span class="dv">9</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb11-12" title="12"><span class="kw">attr</span>(pat3, <span class="st">&quot;trans&quot;</span>) &lt;-<span class="st"> </span>tmat</a></code></pre></div>
<p>We now run the flexsurvjson function to perform the multi-state model analysis using the function from package flexsurv and the pack the predictions in a json file.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb12-1" title="1">results_cf &lt;-<span class="st"> </span>MSMplus<span class="op">::</span><span class="kw">flexsurvjson</span>( <span class="dt">model=</span>cfwei.list, <span class="dt">vartime=</span><span class="kw">seq</span>(<span class="fl">365.25</span>,<span class="fl">365.25</span>,<span class="dt">by=</span><span class="fl">365.25</span>), </a>
<a class="sourceLine" id="cb12-2" title="2">                                   <span class="dt">qmat=</span>tmat, <span class="dt">process=</span><span class="st">&quot;Markov&quot;</span>,</a>
<a class="sourceLine" id="cb12-3" title="3">                                   <span class="dt">totlos=</span><span class="ot">TRUE</span>, <span class="dt">ci.json=</span><span class="ot">FALSE</span>, <span class="dt">cl.json=</span><span class="fl">0.95</span>, <span class="dt">B.json=</span><span class="dv">10</span>, <span class="dt">tcovs=</span><span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb12-4" title="4">                                   <span class="dt">Mjson=</span><span class="dv">100</span>, <span class="dt">variance=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb12-5" title="5">                                   <span class="dt">covariates_list=</span><span class="kw">list</span>(pat1,pat2,pat3), </a>
<a class="sourceLine" id="cb12-6" title="6">                                   <span class="dt">jsonpath=</span><span class="st">&quot;~&quot;</span>,</a>
<a class="sourceLine" id="cb12-7" title="7">                                   <span class="dt">name=</span><span class="st">&quot;predictions_EBMT_flex.json&quot;</span> ) </a></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb13-1" title="1">results_cf<span class="op">$</span>timevar</a>
<a class="sourceLine" id="cb13-2" title="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb13-3" title="3"><span class="co">#&gt; [1] 365.25</span></a>
<a class="sourceLine" id="cb13-4" title="4">results_cf<span class="op">$</span>Nats</a>
<a class="sourceLine" id="cb13-5" title="5"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb13-6" title="6">results_cf<span class="op">$</span>atlist</a>
<a class="sourceLine" id="cb13-7" title="7"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb13-8" title="8"><span class="co">#&gt; [1] &quot;age2 0 age3 0&quot; &quot;age2 1 age3 0&quot; &quot;age2 0 age3 1&quot;</span></a>
<a class="sourceLine" id="cb13-9" title="9">results_cf<span class="op">$</span>tmat</a>
<a class="sourceLine" id="cb13-10" title="10"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb13-11" title="11"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb13-12" title="12"><span class="co">#&gt; [1,]   NA    1    2</span></a>
<a class="sourceLine" id="cb13-13" title="13"><span class="co">#&gt; [2,]   NA   NA    3</span></a>
<a class="sourceLine" id="cb13-14" title="14"><span class="co">#&gt; [3,]   NA   NA   NA</span></a>
<a class="sourceLine" id="cb13-15" title="15">results_cf<span class="op">$</span>Ntransitions</a>
<a class="sourceLine" id="cb13-16" title="16"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb13-17" title="17">results_cf<span class="op">$</span>is.cumhaz</a>
<a class="sourceLine" id="cb13-18" title="18"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb13-19" title="19">results_cf[[<span class="dv">7</span>]]</a>
<a class="sourceLine" id="cb13-20" title="20"><span class="co">#&gt; $P_1_to_1</span></a>
<a class="sourceLine" id="cb13-21" title="21"><span class="co">#&gt; $P_1_to_1[[1]]</span></a>
<a class="sourceLine" id="cb13-22" title="22"><span class="co">#&gt; [1] 0.35851091106239</span></a>
<a class="sourceLine" id="cb13-23" title="23"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-24" title="24"><span class="co">#&gt; $P_1_to_1[[2]]</span></a>
<a class="sourceLine" id="cb13-25" title="25"><span class="co">#&gt; [1] 0.41514049140384</span></a>
<a class="sourceLine" id="cb13-26" title="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-27" title="27"><span class="co">#&gt; $P_1_to_1[[3]]</span></a>
<a class="sourceLine" id="cb13-28" title="28"><span class="co">#&gt; [1] 0.36844706650205</span></a>
<a class="sourceLine" id="cb13-29" title="29"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-30" title="30"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-31" title="31"><span class="co">#&gt; $P_1_to_2</span></a>
<a class="sourceLine" id="cb13-32" title="32"><span class="co">#&gt; $P_1_to_2[[1]]</span></a>
<a class="sourceLine" id="cb13-33" title="33"><span class="co">#&gt; [1] 0.46302410346724</span></a>
<a class="sourceLine" id="cb13-34" title="34"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-35" title="35"><span class="co">#&gt; $P_1_to_2[[2]]</span></a>
<a class="sourceLine" id="cb13-36" title="36"><span class="co">#&gt; [1] 0.37553478255661</span></a>
<a class="sourceLine" id="cb13-37" title="37"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-38" title="38"><span class="co">#&gt; $P_1_to_2[[3]]</span></a>
<a class="sourceLine" id="cb13-39" title="39"><span class="co">#&gt; [1] 0.34602950497214</span></a>
<a class="sourceLine" id="cb13-40" title="40"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-41" title="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-42" title="42"><span class="co">#&gt; $P_1_to_3</span></a>
<a class="sourceLine" id="cb13-43" title="43"><span class="co">#&gt; $P_1_to_3[[1]]</span></a>
<a class="sourceLine" id="cb13-44" title="44"><span class="co">#&gt; [1] 0.17846498547036</span></a>
<a class="sourceLine" id="cb13-45" title="45"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-46" title="46"><span class="co">#&gt; $P_1_to_3[[2]]</span></a>
<a class="sourceLine" id="cb13-47" title="47"><span class="co">#&gt; [1] 0.20932472603956</span></a>
<a class="sourceLine" id="cb13-48" title="48"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-49" title="49"><span class="co">#&gt; $P_1_to_3[[3]]</span></a>
<a class="sourceLine" id="cb13-50" title="50"><span class="co">#&gt; [1] 0.28552342852581</span></a>
<a class="sourceLine" id="cb13-51" title="51"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-52" title="52"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-53" title="53"><span class="co">#&gt; $P_2_to_1</span></a>
<a class="sourceLine" id="cb13-54" title="54"><span class="co">#&gt; $P_2_to_1[[1]]</span></a>
<a class="sourceLine" id="cb13-55" title="55"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb13-56" title="56"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-57" title="57"><span class="co">#&gt; $P_2_to_1[[2]]</span></a>
<a class="sourceLine" id="cb13-58" title="58"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb13-59" title="59"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-60" title="60"><span class="co">#&gt; $P_2_to_1[[3]]</span></a>
<a class="sourceLine" id="cb13-61" title="61"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb13-62" title="62"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-63" title="63"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-64" title="64"><span class="co">#&gt; $P_2_to_2</span></a>
<a class="sourceLine" id="cb13-65" title="65"><span class="co">#&gt; $P_2_to_2[[1]]</span></a>
<a class="sourceLine" id="cb13-66" title="66"><span class="co">#&gt; [1] 0.77202123178319</span></a>
<a class="sourceLine" id="cb13-67" title="67"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-68" title="68"><span class="co">#&gt; $P_2_to_2[[2]]</span></a>
<a class="sourceLine" id="cb13-69" title="69"><span class="co">#&gt; [1] 0.74846811575516</span></a>
<a class="sourceLine" id="cb13-70" title="70"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-71" title="71"><span class="co">#&gt; $P_2_to_2[[3]]</span></a>
<a class="sourceLine" id="cb13-72" title="72"><span class="co">#&gt; [1] 0.61031213157994</span></a>
<a class="sourceLine" id="cb13-73" title="73"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-74" title="74"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-75" title="75"><span class="co">#&gt; $P_2_to_3</span></a>
<a class="sourceLine" id="cb13-76" title="76"><span class="co">#&gt; $P_2_to_3[[1]]</span></a>
<a class="sourceLine" id="cb13-77" title="77"><span class="co">#&gt; [1] 0.22797876821681</span></a>
<a class="sourceLine" id="cb13-78" title="78"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-79" title="79"><span class="co">#&gt; $P_2_to_3[[2]]</span></a>
<a class="sourceLine" id="cb13-80" title="80"><span class="co">#&gt; [1] 0.25153188424484</span></a>
<a class="sourceLine" id="cb13-81" title="81"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-82" title="82"><span class="co">#&gt; $P_2_to_3[[3]]</span></a>
<a class="sourceLine" id="cb13-83" title="83"><span class="co">#&gt; [1] 0.38968786842006</span></a>
<a class="sourceLine" id="cb13-84" title="84"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-85" title="85"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-86" title="86"><span class="co">#&gt; $P_3_to_1</span></a>
<a class="sourceLine" id="cb13-87" title="87"><span class="co">#&gt; $P_3_to_1[[1]]</span></a>
<a class="sourceLine" id="cb13-88" title="88"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb13-89" title="89"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-90" title="90"><span class="co">#&gt; $P_3_to_1[[2]]</span></a>
<a class="sourceLine" id="cb13-91" title="91"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb13-92" title="92"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-93" title="93"><span class="co">#&gt; $P_3_to_1[[3]]</span></a>
<a class="sourceLine" id="cb13-94" title="94"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb13-95" title="95"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-96" title="96"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-97" title="97"><span class="co">#&gt; $P_3_to_2</span></a>
<a class="sourceLine" id="cb13-98" title="98"><span class="co">#&gt; $P_3_to_2[[1]]</span></a>
<a class="sourceLine" id="cb13-99" title="99"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb13-100" title="100"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-101" title="101"><span class="co">#&gt; $P_3_to_2[[2]]</span></a>
<a class="sourceLine" id="cb13-102" title="102"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb13-103" title="103"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-104" title="104"><span class="co">#&gt; $P_3_to_2[[3]]</span></a>
<a class="sourceLine" id="cb13-105" title="105"><span class="co">#&gt; [1] 0</span></a>
<a class="sourceLine" id="cb13-106" title="106"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-107" title="107"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-108" title="108"><span class="co">#&gt; $P_3_to_3</span></a>
<a class="sourceLine" id="cb13-109" title="109"><span class="co">#&gt; $P_3_to_3[[1]]</span></a>
<a class="sourceLine" id="cb13-110" title="110"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb13-111" title="111"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-112" title="112"><span class="co">#&gt; $P_3_to_3[[2]]</span></a>
<a class="sourceLine" id="cb13-113" title="113"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb13-114" title="114"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb13-115" title="115"><span class="co">#&gt; $P_3_to_3[[3]]</span></a>
<a class="sourceLine" id="cb13-116" title="116"><span class="co">#&gt; [1] 1</span></a></code></pre></div>
<p>If the user has used the clock reset approach they have to specify “semiMarkov” at the process argument.</p>
</div>
<div id="msmplus-json-input-file-of-predictions-the-mstatejson-function" class="section level2">
<h2>MSMplus Json input file of predictions: The mstatejson function</h2>
<div id="semi-parametric-analysis" class="section level3">
<h3>Semi parametric analysis</h3>
<p>Apply a Cox proportional hazard model with Markov assumption</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb14-1" title="1">cfcox &lt;-<span class="st"> </span><span class="kw">coxph</span>(<span class="kw">Surv</span>(Tstart, Tstop, status) <span class="op">~</span>age2<span class="op">+</span>age3<span class="op">+</span><span class="kw">strata</span>(trans), <span class="dt">data =</span> msebmt)</a></code></pre></div>
<p>Prediction for different covariate patterns (the 3 age categories)</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb15-1" title="1">wh1 &lt;-<span class="st"> </span><span class="kw">which</span>(msebmt<span class="op">$</span>age2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>msebmt<span class="op">$</span>age3 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb15-2" title="2">pat1 &lt;-<span class="st"> </span>msebmt[<span class="kw">rep</span>(wh1[<span class="dv">1</span>], <span class="dv">3</span>), <span class="dv">9</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb15-3" title="3">pat1<span class="op">$</span>trans &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb15-4" title="4"><span class="kw">attr</span>(pat1, <span class="st">&quot;trans&quot;</span>) &lt;-<span class="st"> </span>tmat</a>
<a class="sourceLine" id="cb15-5" title="5">pat1<span class="op">$</span>strata &lt;-<span class="st"> </span>pat1<span class="op">$</span>trans</a>
<a class="sourceLine" id="cb15-6" title="6"></a>
<a class="sourceLine" id="cb15-7" title="7"></a>
<a class="sourceLine" id="cb15-8" title="8">wh2 &lt;-<span class="st"> </span><span class="kw">which</span>(msebmt<span class="op">$</span>age2 <span class="op">==</span><span class="st"> </span><span class="dv">1</span> <span class="op">&amp;</span><span class="st"> </span>msebmt<span class="op">$</span>age3 <span class="op">==</span><span class="st"> </span><span class="dv">0</span>)</a>
<a class="sourceLine" id="cb15-9" title="9">pat2 &lt;-<span class="st"> </span>msebmt[<span class="kw">rep</span>(wh2[<span class="dv">1</span>], <span class="dv">3</span>), <span class="dv">9</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb15-10" title="10">pat2<span class="op">$</span>trans &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb15-11" title="11"><span class="kw">attr</span>(pat2, <span class="st">&quot;trans&quot;</span>) &lt;-<span class="st"> </span>tmat</a>
<a class="sourceLine" id="cb15-12" title="12">pat2<span class="op">$</span>strata &lt;-<span class="st"> </span>pat2<span class="op">$</span>trans</a>
<a class="sourceLine" id="cb15-13" title="13"></a>
<a class="sourceLine" id="cb15-14" title="14">wh3 &lt;-<span class="st"> </span><span class="kw">which</span>(msebmt<span class="op">$</span>age2 <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="op">&amp;</span><span class="st"> </span>msebmt<span class="op">$</span>age3 <span class="op">==</span><span class="st"> </span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb15-15" title="15">pat3 &lt;-<span class="st"> </span>msebmt[<span class="kw">rep</span>(wh3[<span class="dv">1</span>], <span class="dv">3</span>), <span class="dv">9</span><span class="op">:</span><span class="dv">10</span>]</a>
<a class="sourceLine" id="cb15-16" title="16">pat3<span class="op">$</span>trans &lt;-<span class="st"> </span><span class="dv">1</span><span class="op">:</span><span class="dv">3</span></a>
<a class="sourceLine" id="cb15-17" title="17"><span class="kw">attr</span>(pat3, <span class="st">&quot;trans&quot;</span>) &lt;-<span class="st"> </span>tmat</a>
<a class="sourceLine" id="cb15-18" title="18">pat3<span class="op">$</span>strata &lt;-<span class="st"> </span>pat3<span class="op">$</span>trans</a></code></pre></div>
<p>We now run the mstatejson function to perform the multi-state model analysis using the function from package mstate and the pack the predictions in a json file.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb16-1" title="1">results_semipar &lt;-<span class="st"> </span>MSMplus<span class="op">::</span><span class="kw">mstatejson</span>(<span class="dt">x=</span>cfcox,  <span class="dt">qmat=</span>tmat, <span class="dt">process=</span><span class="st">&quot;Markov&quot;</span>, </a>
<a class="sourceLine" id="cb16-2" title="2">                                <span class="dt">totlos=</span><span class="ot">TRUE</span>, <span class="dt">ci.json=</span><span class="ot">TRUE</span>, <span class="dt">cl.json=</span><span class="fl">0.95</span>, <span class="dt">B.json=</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb16-3" title="3">                                <span class="dt">variance=</span><span class="ot">TRUE</span>, <span class="dt">vartype=</span><span class="st">&quot;greenwood&quot;</span>,</a>
<a class="sourceLine" id="cb16-4" title="4">                                <span class="dt">covariates_list=</span><span class="kw">list</span>(pat1 ,pat2, pat3 ) , <span class="dt">M=</span><span class="dv">100</span>,</a>
<a class="sourceLine" id="cb16-5" title="5">                                <span class="dt">jsonpath=</span><span class="st">&quot;~&quot;</span>,</a>
<a class="sourceLine" id="cb16-6" title="6">                                <span class="dt">name=</span><span class="st">&quot;predictions_EBMT_mstate.json&quot;</span>)</a></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb17-1" title="1"><span class="co">#Timevar</span></a>
<a class="sourceLine" id="cb17-2" title="2">results_semipar<span class="op">$</span>Nats</a>
<a class="sourceLine" id="cb17-3" title="3"><span class="co">#&gt; [1] 3</span></a>
<a class="sourceLine" id="cb17-4" title="4">results_semipar<span class="op">$</span>atlist</a>
<a class="sourceLine" id="cb17-5" title="5"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb17-6" title="6"><span class="co">#&gt; [1] &quot;age2 0 age3 0 trans 1 strata 1&quot; &quot;age2 1 age3 0 trans 1 strata 1&quot;</span></a>
<a class="sourceLine" id="cb17-7" title="7"><span class="co">#&gt; [3] &quot;age2 0 age3 1 trans 1 strata 1&quot;</span></a>
<a class="sourceLine" id="cb17-8" title="8">results_semipar<span class="op">$</span>tmat</a>
<a class="sourceLine" id="cb17-9" title="9"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb17-10" title="10"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb17-11" title="11"><span class="co">#&gt; [1,]   NA    1    2</span></a>
<a class="sourceLine" id="cb17-12" title="12"><span class="co">#&gt; [2,]   NA   NA    3</span></a>
<a class="sourceLine" id="cb17-13" title="13"><span class="co">#&gt; [3,]   NA   NA   NA</span></a>
<a class="sourceLine" id="cb17-14" title="14">results_semipar<span class="op">$</span>is.cumhaz</a>
<a class="sourceLine" id="cb17-15" title="15"><span class="co">#&gt; [1] 1</span></a>
<a class="sourceLine" id="cb17-16" title="16">results_semipar[[<span class="dv">6</span>]]<span class="op">$</span>P_<span class="dv">1</span>_to_<span class="dv">1</span>[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-17" title="17"><span class="co">#&gt;      [,1]         [,2]         [,3]         [,4]         [,5]</span></a>
<a class="sourceLine" id="cb17-18" title="18"><span class="co">#&gt; [1,]    1 0.9991159072 0.9986738608 0.9982318243 0.9973471222</span></a>
<a class="sourceLine" id="cb17-19" title="19"><span class="co">#&gt; [2,]    1 0.9991604695 0.9987406855 0.9983209015 0.9974807175</span></a>
<a class="sourceLine" id="cb17-20" title="20"><span class="co">#&gt; [3,]    1 0.9989781525 0.9984672992 0.9979564925 0.9969342228</span></a>
<a class="sourceLine" id="cb17-21" title="21">results_semipar[[<span class="dv">6</span>]]<span class="op">$</span>P_<span class="dv">1</span>_to_<span class="dv">2</span>[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-22" title="22"><span class="co">#&gt;      [,1]            [,2]            [,3]            [,4]            [,5]</span></a>
<a class="sourceLine" id="cb17-23" title="23"><span class="co">#&gt; [1,]    0 0.0004420463943 0.0008840927887 0.0008840927887 0.0008840927887</span></a>
<a class="sourceLine" id="cb17-24" title="24"><span class="co">#&gt; [2,]    0 0.0004197652558 0.0008395492338 0.0008395492338 0.0008395492338</span></a>
<a class="sourceLine" id="cb17-25" title="25"><span class="co">#&gt; [3,]    0 0.0005109237597 0.0010217770750 0.0010217770750 0.0010217770750</span></a>
<a class="sourceLine" id="cb17-26" title="26">results_semipar[[<span class="dv">6</span>]]<span class="op">$</span>P_<span class="dv">1</span>_to_<span class="dv">3</span>[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-27" title="27"><span class="co">#&gt;      [,1]            [,2]            [,3]            [,4]           [,5]</span></a>
<a class="sourceLine" id="cb17-28" title="28"><span class="co">#&gt; [1,]    0 0.0004420463943 0.0004420463943 0.0008840829265 0.001768784975</span></a>
<a class="sourceLine" id="cb17-29" title="29"><span class="co">#&gt; [2,]    0 0.0004197652558 0.0004197652558 0.0008395492338 0.001679733263</span></a>
<a class="sourceLine" id="cb17-30" title="30"><span class="co">#&gt; [3,]    0 0.0005109237597 0.0005109237597 0.0010217304456 0.002044000117</span></a>
<a class="sourceLine" id="cb17-31" title="31">results_semipar[[<span class="dv">6</span>]]<span class="op">$</span>P_<span class="dv">2</span>_to_<span class="dv">1</span>[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-32" title="32"><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></a>
<a class="sourceLine" id="cb17-33" title="33"><span class="co">#&gt; [1,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-34" title="34"><span class="co">#&gt; [2,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-35" title="35"><span class="co">#&gt; [3,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-36" title="36">results_semipar[[<span class="dv">6</span>]]<span class="op">$</span>P_<span class="dv">2</span>_to_<span class="dv">2</span>[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-37" title="37"><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></a>
<a class="sourceLine" id="cb17-38" title="38"><span class="co">#&gt; [1,]    1    1    1    1    1</span></a>
<a class="sourceLine" id="cb17-39" title="39"><span class="co">#&gt; [2,]    1    1    1    1    1</span></a>
<a class="sourceLine" id="cb17-40" title="40"><span class="co">#&gt; [3,]    1    1    1    1    1</span></a>
<a class="sourceLine" id="cb17-41" title="41">results_semipar[[<span class="dv">6</span>]]<span class="op">$</span>P_<span class="dv">2</span>_to_<span class="dv">3</span>[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-42" title="42"><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></a>
<a class="sourceLine" id="cb17-43" title="43"><span class="co">#&gt; [1,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-44" title="44"><span class="co">#&gt; [2,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-45" title="45"><span class="co">#&gt; [3,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-46" title="46">results_semipar[[<span class="dv">6</span>]]<span class="op">$</span>P_<span class="dv">3</span>_to_<span class="dv">1</span>[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-47" title="47"><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></a>
<a class="sourceLine" id="cb17-48" title="48"><span class="co">#&gt; [1,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-49" title="49"><span class="co">#&gt; [2,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-50" title="50"><span class="co">#&gt; [3,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-51" title="51">results_semipar[[<span class="dv">6</span>]]<span class="op">$</span>P_<span class="dv">3</span>_to_<span class="dv">2</span>[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-52" title="52"><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></a>
<a class="sourceLine" id="cb17-53" title="53"><span class="co">#&gt; [1,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-54" title="54"><span class="co">#&gt; [2,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-55" title="55"><span class="co">#&gt; [3,]    0    0    0    0    0</span></a>
<a class="sourceLine" id="cb17-56" title="56">results_semipar[[<span class="dv">6</span>]]<span class="op">$</span>P_<span class="dv">3</span>_to_<span class="dv">3</span>[,<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</a>
<a class="sourceLine" id="cb17-57" title="57"><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></a>
<a class="sourceLine" id="cb17-58" title="58"><span class="co">#&gt; [1,]    1    1    1    1    1</span></a>
<a class="sourceLine" id="cb17-59" title="59"><span class="co">#&gt; [2,]    1    1    1    1    1</span></a>
<a class="sourceLine" id="cb17-60" title="60"><span class="co">#&gt; [3,]    1    1    1    1    1</span></a>
<a class="sourceLine" id="cb17-61" title="61"><span class="co">#The measures are not displayed here to save space </span></a></code></pre></div>
</div>
</div>
<div id="msmplus-json-input-file-of-predictions-the-msmjson-function" class="section level2">
<h2>MSMplus Json input file of predictions: The msmjson function</h2>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb18-1" title="1"><span class="kw">head</span>(cav)</a>
<a class="sourceLine" id="cb18-2" title="2"><span class="co">#&gt;    PTNUM         age       years dage sex pdiag cumrej state firstobs statemax</span></a>
<a class="sourceLine" id="cb18-3" title="3"><span class="co">#&gt; 1 100002 52.49589041 0.000000000   21   0   IHD      0     1        1        1</span></a>
<a class="sourceLine" id="cb18-4" title="4"><span class="co">#&gt; 2 100002 53.49863014 1.002739726   21   0   IHD      2     1        0        1</span></a>
<a class="sourceLine" id="cb18-5" title="5"><span class="co">#&gt; 3 100002 54.49863014 2.002739726   21   0   IHD      2     2        0        2</span></a>
<a class="sourceLine" id="cb18-6" title="6"><span class="co">#&gt; 4 100002 55.58904110 3.093150685   21   0   IHD      2     2        0        2</span></a>
<a class="sourceLine" id="cb18-7" title="7"><span class="co">#&gt; 5 100002 56.49589041 4.000000000   21   0   IHD      3     2        0        2</span></a>
<a class="sourceLine" id="cb18-8" title="8"><span class="co">#&gt; 6 100002 57.49315068 4.997260274   21   0   IHD      3     3        0        3</span></a></code></pre></div>
<p>Renaming variable PTNUM to id</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb19-1" title="1"> cav<span class="op">$</span>id=cav<span class="op">$</span>PTNUM</a></code></pre></div>
<p>Defining the transition matrix</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb20-1" title="1">    tmat=<span class="kw">matrix</span>(<span class="ot">NA</span>,<span class="dt">nrow=</span><span class="dv">4</span>,<span class="dt">ncol=</span><span class="dv">4</span>)</a>
<a class="sourceLine" id="cb20-2" title="2">    tmat[<span class="dv">1</span>,<span class="dv">2</span>]=<span class="dv">1</span>; tmat[<span class="dv">1</span>,<span class="dv">4</span>]=<span class="dv">2</span>; tmat[<span class="dv">2</span>,<span class="dv">1</span>]=<span class="dv">3</span>; tmat[<span class="dv">2</span>,<span class="dv">3</span>]=<span class="dv">4</span></a>
<a class="sourceLine" id="cb20-3" title="3">    tmat[<span class="dv">2</span>,<span class="dv">4</span>]=<span class="dv">5</span>; tmat[<span class="dv">3</span>,<span class="dv">2</span>]=<span class="dv">6</span>; tmat[<span class="dv">3</span>,<span class="dv">4</span>]=<span class="dv">7</span></a></code></pre></div>
<p>We can now call function msboxes_R</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb21-1" title="1">    results3_days=MSMplus<span class="op">::</span><span class="kw">msboxes_R</span>(<span class="dt">data=</span>cav,<span class="dt">id=</span> cav<span class="op">$</span>id, <span class="dt">yb=</span><span class="kw">c</span>(<span class="fl">0.3</span>,<span class="fl">0.5</span>,<span class="fl">0.6</span>,<span class="fl">0.75</span>), <span class="dt">msm=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb21-2" title="2">                            <span class="dt">xb=</span><span class="kw">c</span>(<span class="fl">0.5</span>,<span class="fl">0.2</span>,<span class="fl">0.7</span>,<span class="fl">0.3</span>),<span class="dt">boxwidth=</span><span class="fl">0.1</span>,<span class="dt">boxheight=</span><span class="fl">0.1</span>,</a>
<a class="sourceLine" id="cb21-3" title="3">                            <span class="dt">tmatrix=</span> tmat, <span class="dt">vartime=</span><span class="kw">seq</span>(<span class="dv">0</span>,<span class="dv">10</span>,<span class="dt">by=</span><span class="dv">1</span>),<span class="dt">scale=</span><span class="dv">1</span>,</a>
<a class="sourceLine" id="cb21-4" title="4">                            <span class="dt">jsonpath=</span><span class="st">&quot;~&quot;</span>, <span class="dt">name=</span><span class="st">&quot;msboxes_msm.json&quot;</span> ) </a></code></pre></div>
<p>Defining the transition matrix with initial values under an initial assumption</p>
<p>0 for transitions not allowed, initial values for rest of transitions under a rationale ##</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb22-1" title="1">Q&lt;-<span class="st"> </span><span class="kw">rbind</span>(<span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>,<span class="dv">0</span>,<span class="fl">0.25</span>),<span class="kw">c</span>(<span class="fl">0.166</span>,<span class="dv">0</span>,<span class="fl">0.166</span>,<span class="fl">0.166</span>),<span class="kw">c</span>(<span class="dv">0</span>,<span class="fl">0.25</span>,<span class="dv">0</span>,<span class="fl">0.25</span>),<span class="kw">c</span>(<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>,<span class="dv">0</span>))</a>
<a class="sourceLine" id="cb22-2" title="2">    </a></code></pre></div>
<p>Getting initial Q matrix in a default way- Feed the hand made matrix</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb23-1" title="1">    q.crude&lt;-<span class="st"> </span><span class="kw">crudeinits.msm</span>(state<span class="op">~</span>years, id,<span class="dt">data=</span>cav, <span class="dt">qmatrix=</span>Q)</a></code></pre></div>
<p>Apply the msm model</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb24-1" title="1">    cavsex.msm&lt;-<span class="st"> </span><span class="kw">msm</span>(state<span class="op">~</span>years, <span class="dt">covariates=</span><span class="op">~</span>sex, id,<span class="dt">data=</span>cav,<span class="dt">qmatrix=</span>q.crude, <span class="dt">deathexact =</span> <span class="dv">4</span>, <span class="dt">control=</span><span class="kw">list</span>(<span class="dt">trace=</span><span class="dv">1</span>,<span class="dt">REPORT=</span><span class="dv">1</span>)) </a>
<a class="sourceLine" id="cb24-2" title="2">    <span class="kw">summary</span>(cavsex.msm)</a></code></pre></div>
<p>Prediction for different covariate patterns (males and females)</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb25-1" title="1">results &lt;-<span class="st"> </span>MSMplus<span class="op">::</span><span class="kw">msmjson</span>(<span class="dt">msm.model=</span>cavsex.msm, <span class="dt">vartime=</span><span class="kw">seq</span>(<span class="dv">1</span>,<span class="dv">3</span>,<span class="dv">1</span>), <span class="dt">mat.init=</span>q.crude,</a>
<a class="sourceLine" id="cb25-2" title="2">                       <span class="dt">totlos=</span><span class="ot">TRUE</span>, <span class="dt">visit=</span><span class="ot">TRUE</span>, <span class="dt">sojourn=</span><span class="ot">TRUE</span>, <span class="dt">pnext=</span><span class="ot">TRUE</span>, <span class="dt">efpt=</span><span class="ot">TRUE</span>, <span class="dt">envisits=</span><span class="ot">TRUE</span>,</a>
<a class="sourceLine" id="cb25-3" title="3">                       <span class="dt">ci.json=</span><span class="st">&quot;normal&quot;</span>, <span class="dt">cl.json=</span><span class="fl">0.95</span>, <span class="dt">B.json=</span><span class="dv">10</span>,</a>
<a class="sourceLine" id="cb25-4" title="4">                       <span class="dt">cores.json=</span><span class="ot">NULL</span>,<span class="dt">piecewise.times.json=</span><span class="ot">NULL</span>,</a>
<a class="sourceLine" id="cb25-5" title="5">                       <span class="dt">piecewise.covariates.json=</span><span class="ot">NULL</span>,<span class="dt">num.integ.json=</span><span class="ot">FALSE</span>,</a>
<a class="sourceLine" id="cb25-6" title="6">                       <span class="dt">covariates_list=</span><span class="kw">list</span>(<span class="kw">list</span>(<span class="dt">sex =</span> <span class="dv">1</span>),<span class="kw">list</span>(<span class="dt">sex =</span> <span class="dv">0</span>)), </a>
<a class="sourceLine" id="cb25-7" title="7">                       <span class="dt">jsonpath=</span><span class="st">&quot;~&quot;</span>,</a>
<a class="sourceLine" id="cb25-8" title="8">                       <span class="dt">name=</span><span class="st">&quot;predictions_msm.json&quot;</span> ) </a></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb26-1" title="1">results<span class="op">$</span>timevar</a>
<a class="sourceLine" id="cb26-2" title="2"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb26-3" title="3"><span class="co">#&gt; [1] 1 2 3</span></a>
<a class="sourceLine" id="cb26-4" title="4">results<span class="op">$</span>Nats</a>
<a class="sourceLine" id="cb26-5" title="5"><span class="co">#&gt; [1] 2</span></a>
<a class="sourceLine" id="cb26-6" title="6">results<span class="op">$</span>atlist</a>
<a class="sourceLine" id="cb26-7" title="7"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb26-8" title="8"><span class="co">#&gt; [1] &quot;sex 1&quot; &quot;sex 0&quot;</span></a>
<a class="sourceLine" id="cb26-9" title="9">results<span class="op">$</span>tmat</a>
<a class="sourceLine" id="cb26-10" title="10"><span class="co">#&gt; [[1]]</span></a>
<a class="sourceLine" id="cb26-11" title="11"><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></a>
<a class="sourceLine" id="cb26-12" title="12"><span class="co">#&gt; [1,]   NA    1   NA    2</span></a>
<a class="sourceLine" id="cb26-13" title="13"><span class="co">#&gt; [2,]    3   NA    4    5</span></a>
<a class="sourceLine" id="cb26-14" title="14"><span class="co">#&gt; [3,]   NA    6   NA    7</span></a>
<a class="sourceLine" id="cb26-15" title="15"><span class="co">#&gt; [4,]   NA   NA   NA   NA</span></a>
<a class="sourceLine" id="cb26-16" title="16">results[[<span class="dv">7</span>]]</a>
<a class="sourceLine" id="cb26-17" title="17"><span class="co">#&gt; $P_1_to_1</span></a>
<a class="sourceLine" id="cb26-18" title="18"><span class="co">#&gt;              [,1]         [,2]         [,3]</span></a>
<a class="sourceLine" id="cb26-19" title="19"><span class="co">#&gt; [1,] 0.8921454560 0.8065852142 0.7351300975</span></a>
<a class="sourceLine" id="cb26-20" title="20"><span class="co">#&gt; [2,] 0.8483842837 0.7341323015 0.6435779023</span></a>
<a class="sourceLine" id="cb26-21" title="21"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-22" title="22"><span class="co">#&gt; $P_1_to_2</span></a>
<a class="sourceLine" id="cb26-23" title="23"><span class="co">#&gt;               [,1]          [,2]         [,3]</span></a>
<a class="sourceLine" id="cb26-24" title="24"><span class="co">#&gt; [1,] 0.05341130715 0.07732942208 0.0866386587</span></a>
<a class="sourceLine" id="cb26-25" title="25"><span class="co">#&gt; [2,] 0.09383818220 0.13415420268 0.1484913704</span></a>
<a class="sourceLine" id="cb26-26" title="26"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-27" title="27"><span class="co">#&gt; $P_1_to_3</span></a>
<a class="sourceLine" id="cb26-28" title="28"><span class="co">#&gt;                [,1]          [,2]          [,3]</span></a>
<a class="sourceLine" id="cb26-29" title="29"><span class="co">#&gt; [1,] 0.008264171544 0.02048173406 0.02949596678</span></a>
<a class="sourceLine" id="cb26-30" title="30"><span class="co">#&gt; [2,] 0.015428153651 0.04266731304 0.06756165219</span></a>
<a class="sourceLine" id="cb26-31" title="31"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-32" title="32"><span class="co">#&gt; $P_1_to_4</span></a>
<a class="sourceLine" id="cb26-33" title="33"><span class="co">#&gt;               [,1]          [,2]         [,3]</span></a>
<a class="sourceLine" id="cb26-34" title="34"><span class="co">#&gt; [1,] 0.04617906533 0.09560362961 0.1487352770</span></a>
<a class="sourceLine" id="cb26-35" title="35"><span class="co">#&gt; [2,] 0.04234938044 0.08904618282 0.1403690751</span></a>
<a class="sourceLine" id="cb26-36" title="36"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-37" title="37"><span class="co">#&gt; $P_2_to_1</span></a>
<a class="sourceLine" id="cb26-38" title="38"><span class="co">#&gt;              [,1]         [,2]         [,3]</span></a>
<a class="sourceLine" id="cb26-39" title="39"><span class="co">#&gt; [1,] 0.1977501750 0.2863046715 0.3207712156</span></a>
<a class="sourceLine" id="cb26-40" title="40"><span class="co">#&gt; [2,] 0.1516200046 0.2167610279 0.2399264537</span></a>
<a class="sourceLine" id="cb26-41" title="41"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-42" title="42"><span class="co">#&gt; $P_2_to_2</span></a>
<a class="sourceLine" id="cb26-43" title="43"><span class="co">#&gt;              [,1]         [,2]         [,3]</span></a>
<a class="sourceLine" id="cb26-44" title="44"><span class="co">#&gt; [1,] 0.5449698835 0.3196826319 0.2017159324</span></a>
<a class="sourceLine" id="cb26-45" title="45"><span class="co">#&gt; [2,] 0.5682887563 0.3532555472 0.2412915804</span></a>
<a class="sourceLine" id="cb26-46" title="46"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-47" title="47"><span class="co">#&gt; $P_2_to_3</span></a>
<a class="sourceLine" id="cb26-48" title="48"><span class="co">#&gt;              [,1]         [,2]         [,3]</span></a>
<a class="sourceLine" id="cb26-49" title="49"><span class="co">#&gt; [1,] 0.1754701337 0.1766023257 0.1383149131</span></a>
<a class="sourceLine" id="cb26-50" title="50"><span class="co">#&gt; [2,] 0.2039322016 0.2562516981 0.2488140330</span></a>
<a class="sourceLine" id="cb26-51" title="51"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-52" title="52"><span class="co">#&gt; $P_2_to_4</span></a>
<a class="sourceLine" id="cb26-53" title="53"><span class="co">#&gt;               [,1]         [,2]        [,3]</span></a>
<a class="sourceLine" id="cb26-54" title="54"><span class="co">#&gt; [1,] 0.08180980783 0.2174103709 0.339197939</span></a>
<a class="sourceLine" id="cb26-55" title="55"><span class="co">#&gt; [2,] 0.07615903742 0.1737317267 0.269967933</span></a>
<a class="sourceLine" id="cb26-56" title="56"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-57" title="57"><span class="co">#&gt; $P_3_to_1</span></a>
<a class="sourceLine" id="cb26-58" title="58"><span class="co">#&gt;               [,1]          [,2]          [,3]</span></a>
<a class="sourceLine" id="cb26-59" title="59"><span class="co">#&gt; [1,] 0.01205254483 0.02987075192 0.04301719296</span></a>
<a class="sourceLine" id="cb26-60" title="60"><span class="co">#&gt; [2,] 0.00963582511 0.02664834533 0.04219638197</span></a>
<a class="sourceLine" id="cb26-61" title="61"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-62" title="62"><span class="co">#&gt; $P_3_to_2</span></a>
<a class="sourceLine" id="cb26-63" title="63"><span class="co">#&gt;               [,1]          [,2]          [,3]</span></a>
<a class="sourceLine" id="cb26-64" title="64"><span class="co">#&gt; [1,] 0.06911924242 0.06956522287 0.05448347138</span></a>
<a class="sourceLine" id="cb26-65" title="65"><span class="co">#&gt; [2,] 0.07882860515 0.09905235060 0.09617737173</span></a>
<a class="sourceLine" id="cb26-66" title="66"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-67" title="67"><span class="co">#&gt; $P_3_to_3</span></a>
<a class="sourceLine" id="cb26-68" title="68"><span class="co">#&gt;              [,1]         [,2]         [,3]</span></a>
<a class="sourceLine" id="cb26-69" title="69"><span class="co">#&gt; [1,] 0.4521689492 0.2166847256 0.1104315806</span></a>
<a class="sourceLine" id="cb26-70" title="70"><span class="co">#&gt; [2,] 0.6767940674 0.4742745636 0.3415973097</span></a>
<a class="sourceLine" id="cb26-71" title="71"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-72" title="72"><span class="co">#&gt; $P_3_to_4</span></a>
<a class="sourceLine" id="cb26-73" title="73"><span class="co">#&gt;              [,1]         [,2]         [,3]</span></a>
<a class="sourceLine" id="cb26-74" title="74"><span class="co">#&gt; [1,] 0.4666592636 0.6838792996 0.7920677550</span></a>
<a class="sourceLine" id="cb26-75" title="75"><span class="co">#&gt; [2,] 0.2347415024 0.4000247404 0.5200289366</span></a>
<a class="sourceLine" id="cb26-76" title="76"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-77" title="77"><span class="co">#&gt; $P_4_to_1</span></a>
<a class="sourceLine" id="cb26-78" title="78"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb26-79" title="79"><span class="co">#&gt; [1,]    0    0    0</span></a>
<a class="sourceLine" id="cb26-80" title="80"><span class="co">#&gt; [2,]    0    0    0</span></a>
<a class="sourceLine" id="cb26-81" title="81"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-82" title="82"><span class="co">#&gt; $P_4_to_2</span></a>
<a class="sourceLine" id="cb26-83" title="83"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb26-84" title="84"><span class="co">#&gt; [1,]    0    0    0</span></a>
<a class="sourceLine" id="cb26-85" title="85"><span class="co">#&gt; [2,]    0    0    0</span></a>
<a class="sourceLine" id="cb26-86" title="86"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-87" title="87"><span class="co">#&gt; $P_4_to_3</span></a>
<a class="sourceLine" id="cb26-88" title="88"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb26-89" title="89"><span class="co">#&gt; [1,]    0    0    0</span></a>
<a class="sourceLine" id="cb26-90" title="90"><span class="co">#&gt; [2,]    0    0    0</span></a>
<a class="sourceLine" id="cb26-91" title="91"><span class="co">#&gt; </span></a>
<a class="sourceLine" id="cb26-92" title="92"><span class="co">#&gt; $P_4_to_4</span></a>
<a class="sourceLine" id="cb26-93" title="93"><span class="co">#&gt;      [,1] [,2] [,3]</span></a>
<a class="sourceLine" id="cb26-94" title="94"><span class="co">#&gt; [1,]    1    1    1</span></a>
<a class="sourceLine" id="cb26-95" title="95"><span class="co">#&gt; [2,]    1    1    1</span></a>
<a class="sourceLine" id="cb26-96" title="96"><span class="co">#The rest of the measures are not displayed here to save space </span></a></code></pre></div>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
